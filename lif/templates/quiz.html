{% extends "base.html" %}

{% block title %}Quiz Challenge - Project LIF{% endblock %}
{% block meta_description %}Test your lip reading skills with interactive quizzes and earn points.{% endblock %}

{% block content %}
<section class="quiz-section py-5">
    <div class="container">
        <div class="row text-center mb-4">
            <div class="col-lg-8 mx-auto">
                <h1 class="display-5 fw-bold mb-3">
                    <i class="fas fa-gamepad gradient-text me-3"></i>
                    Test your <span class="gradient-text">Lip Reading</span> Skills
                </h1>
                <p class="lead text-light"></p>
            </div>
        </div>

        <!-- Quiz Stats Bar (Hidden initially) -->
        <div class="row mb-4" id="statsBar" style="display: none;">
            <div class="col-12">
                <div class="quiz-stats-bar">
                    <div class="card bg-dark-card border-0 shadow-lg">
                        <div class="card-body p-3">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="stat-item">
                                        <div class="stat-value" id="currentScore">0</div>
                                        <div class="stat-label">Score</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-item">
                                        <div class="stat-value" id="currentStreak">0</div>
                                        <div class="stat-label">Streak</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-item">
                                        <div class="stat-value" id="questionNumber">0</div>
                                        <div class="stat-label">Question</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-item">
                                        <div class="stat-value" id="timeLeft">30</div>
                                        <div class="stat-label">Time</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Start Screen -->
                <div class="quiz-start-screen" id="startScreen">
                    <div class="card bg-dark-card border-0 shadow-lg text-center">
                        <div class="card-body p-5">
                            <div class="quiz-icon mb-4">
                                <i class="fas fa-trophy fa-4x gradient-text"></i>
                            </div>
                            <h3 class="text-light mb-3">Handa ka na ba?</h3>
                            <p class="text-light mb-4">
                                Tingnan ng mabuti ang video at basahin kung ano ang binibigkas, piliin ang sa tingin mong tamang sagot.
                            </p>
                            <button class="btn btn-primary btn-lg" id="startQuiz">
                                <i class="fas fa-play me-2"></i>Start Quiz
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Game Screen -->
                <div class="quiz-game-screen" id="gameScreen" style="display: none;">
                    <div class="card bg-dark-card border-0 shadow-lg">
                        <div class="card-body p-4">
                            <div class="quiz-progress mb-4">
                                <div class="progress">
                                    <div class="progress-bar bg-gradient-primary" id="progressBar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <div class="text-center mt-2">
                                    <small class="text-light" id="progressText">Question 1 of 10</small>
                                </div>
                            </div>

                            <div class="question-area text-center mb-4">
                                <h4 class="text-light mb-3">Anong syllable ang iyong nababasa?</h4>
                                
                                <!-- Smaller GIF Display -->
                                <div class="gif-display mb-4">
                                    <div class="gif-container-small" id="questionGif">
                                        <div class="gif-placeholder">
                                            <i class="fas fa-play-circle fa-3x gradient-text"></i>
                                            <p class="mt-2 text-light">Loading...</p>
                                        </div>
                                    </div>
                                    
                                    <!-- GIF Controls -->
                                    <div class="gif-controls mt-3" id="gifControls" style="display: none;">
                                        <button class="btn btn-outline-primary btn-sm me-2" id="playGifBtn">
                                            <i class="fas fa-play me-1"></i>Play
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" id="loopGifBtn">
                                            <i class="fas fa-redo me-1"></i>Loop
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Enhanced Answer Options Grid -->
                            <div class="answer-options-grid" id="answerOptions">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                            
                            <div class="answer-feedback" id="answerFeedback" style="display: none;">
                                <div class="feedback-content">
                                    <div class="feedback-text">
                                        <h5 class="text-light">Tama!</h5>
                                        <p class="text-light">Nakakuha ka ng 10 points.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
           
<!-- Results Screen -->
<div class="quiz-results-screen" id="resultsScreen" style="display: none;">
  <div class="card bg-dark-card border-0 shadow-lg text-center">
    <div class="card-body p-5">
      <div class="results-icon mb-4">
        <i class="fas fa-medal fa-4x gradient-text"></i>
      </div>
      <h3 class="text-light mb-3">Test Complete!</h3>
      
      <!-- Final Stats -->
      <div class="final-stats mb-4 text-light">
        <div class="row">
          <div class="col-md-3">
            <div class="final-stat">
              <div class="final-stat-value text-light" id="finalScore">0</div>
              <div class="final-stat-label text-light">Final Score</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="final-stat">
              <div class="final-stat-value text-light" id="finalAccuracy">0%</div>
              <div class="final-stat-label text-light">Accuracy</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="final-stat">
              <div class="final-stat-value text-light" id="finalStreak">0</div>
              <div class="final-stat-label text-light">Best Streak</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="final-stat">
              <div class="final-stat-value text-light" id="totalTime">0s</div>
              <div class="final-stat-label text-light">Total Time</div>
            </div>
          </div>
        </div>
      </div>

      <!-- High Scores -->
      <div class="high-scores mb-4">
        <h5 class="text-light mb-3">Your Top Scores</h5>
        <div id="highScoresList" class="text-start">
          <!-- Populated by JS -->
        </div>
      </div>

      <!-- Detailed Results with GIF Previews -->
      <div class="detailed-results mb-4">
        <h5 class="text-light mb-3">Question Breakdown</h5>
        <div id="resultsBreakdown" class="text-start">
          <!-- Results will be populated by JavaScript -->
        </div>
      </div>
      
      <!-- Actions -->
      <div class="results-actions">
        <button class="btn btn-primary btn-lg me-3" id="playAgain">
          <i class="fas fa-redo me-2"></i>Play Again
        </button>
        <a href="{{ url_for('learn') }}" class="btn btn-outline-light btn-lg">
          <i class="fas fa-graduation-cap me-2"></i>Continue Learning
        </a>
      </div>
    </div>
  </div>
</div>

            </div>

            <div class="col-lg-4">
                <!-- Timer Card (Hidden initially, shown during quiz) -->
                <div class="tips-container" id="timerCard" style="display: none;">
                    <div class="card bg-dark-card border-0 shadow-lg">
                        <div class="card-body">
                            <h5 class="card-title text-light mb-3">
                                <i class="fas fa-clock text-primary me-2"></i>
                                Timer:
                            </h5>
                            <!-- Animated Timer Clock -->
                            <div class="timer-container mb-4">
                                <div class="animated-clock" id="animatedClock">
                                    <div class="clock-face">
                                        <div class="clock-hand" id="clockHand"></div>
                                        <div class="clock-numbers">
                                            <span class="clock-number" style="--i: 1;">30</span>
                                            <span class="clock-number" style="--i: 2;"></span>
                                            <span class="clock-number" style="--i: 3;"></span>
                                            <span class="clock-number" style="--i: 4;"></span>
                                            <span class="clock-number" style="--i: 5;">15</span>
                                            <span class="clock-number" style="--i: 6;"></span>
                                        </div>
                                        <div class="clock-center"></div>
                                    </div>
                                    <div class="timer-text" id="timerText">30</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tips Card (Always visible) -->
                <div class="tips-container" id="tipsCard">
                    <div class="card bg-dark-card border-0 shadow-lg">
                        <div class="card-body">
                            <h5 class="card-title text-light mb-3">
                                <i class="fas fa-lightbulb gradient-text me-2"></i>
                                Mga Tips:
                            </h5>
                            <ul class="tips-list">
                                <li class="tip-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Panoorin muna nang buo ang video bago sumagot.
                                </li>
                                <li class="tip-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Bigyang-pansin ang hugis at galaw ng bibig.
                                </li>
                                <li class="tip-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Magtiwala sa iyong sarili.
                                </li>
                                <li class="tip-item">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    Mag-practice nang regular para mas mapahusay ang iyong skills.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Analysis Card (Hidden initially, shown after quiz completion) -->
                <div class="tips-container" id="analysisCard" style="display: none;">
                    <div class="card bg-dark-card border-0 shadow-lg mt-4">
                        <div class="card-body">
                            <h5 class="card-title text-light mb-3">
                                <i class="fas fa-chart-line text-success me-2"></i>
                                Analysis
                            </h5>
                            <!-- Analysis -->
                            <div class="analysis-section mb-4">
                                <div class="row">
                                    <div class="col-md-12 mb-3">
                                        <h6 class="text-success mb-2">Strengths</h6>
                                        <div id="strengthsList" class="analysis-list">
                                            <div class="analysis-item text-muted">Complete a quiz to see your strengths!</div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <h6 class="text-warning mb-2">Areas to Improve</h6>
                                        <div id="weaknessesList" class="analysis-list">
                                            <div class="analysis-item text-muted">Complete a quiz to see areas for improvement!</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/quiz.js') }}"></script>
{% endblock %}
